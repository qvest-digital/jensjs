<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <meta http-equiv="Content-Style-Type" content="text/css" />
 <meta name="MSSmartTagsPreventParsing" content="TRUE" />
 <!-- link rel="stylesheet" type="text/css" href="vstyle.css" / -->
 <title>jensjs start page</title>
 <meta name="robots" content="noindex, nofollow" />
 <style type="text/css"><!--/*--><![CDATA[/*><!--*/
  #tbl {
	width:100%;
	table-layout:auto;
	border-spacing:0.5em;
  }
  #tbl th {
	text-align:left;
  }
  #tbl textarea {
	width:100%;
  }
  .hidden {
	display:none;
  }
  .green {
	background-color:green;
  }
  .yellow {
	background-color:yellow;
  }
  .red {
	background-color:red;
  }
  button {
	appearance:none;
	display:block;
  }
  button.eb {
	width:2.5em;
  }
  tt {
	white-space:nowrap;
  }
 /*]]>*/--></style>
 <script type="text/javascript" src="deferDOM.js"></script>
 <script type="text/javascript"><!--//--><![CDATA[//><!--
  var xhsafe = (function () {
	// XML/HTML/XHTML-safe and no C0/DEL/C1 control characters; nÅn-BMP unfiltered
	var re = /((?:[\t\n\r -~\xA0-\uD7FF\uE000-\uFFFD]|[\uD800-\uDBFF][\uDC00-\uDFFF])+)/;

	return (function xhsafe(s) {
		var os = '';
		var g = s.split(re);
		var i, j;

		for (i = 0; i < g.length; ++i) {
			for (j = 0; j < g[i].length; ++j)
				os += "\uFFFD";
			if (++i < g.length)
				os += g[i];
		}
		return (os);
	});
  })();
  var ta2s = (function () {
	var sa = /&/g;
	var sb = /</g;
	var sc = />/g;
	var sd = /\n/g;

	return (function ta2s(s) {
		s = s.replace(sa, '&amp;');
		s = s.replace(sb, '&lt;');
		s = s.replace(sc, '&gt;');
		s = s.replace(sd, '<br />');
		return (s);
	});
  })();
  deferDOM(function onDOMusable() {
	var lst = document.getElementById('sessionlist');
	var msg = document.getElementById('msg');
	var tbl = document.getElementById('tbl');
	var ids = {};
	function clkBtn() {
		alert("not implemented yet; ID=" + this.data);
	}
	function pencilBtn() {
		var num = this.data;
		var elts = ids[num];
		elts[1].value = elts[5];
		elts[0].className = "hidden";
		elts[1].className = "";
		elts[2].className = "eb hidden";
		elts[3].className = "eb";
		elts[4].className = "eb";
	}
	function editOkBtn() {
		var num = this.data;
		var elts = ids[num];
		elts[5] = xhsafe(elts[1].value);
		elts[1].value = elts[5];
		elts[0].innerHTML = ta2s(elts[5]);
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function xhrEvent() {
			if (xhr.readyState !== 4)
				return;
			if (xhr.status === 204) {
				elts[0].className = "";
				elts[1].className = "hidden";
				elts[2].className = "eb green";
				elts[3].className = "eb hidden";
				elts[4].className = "eb hidden";
			} else {
				elts[3].className = "eb red";
			}
		};
		elts[3].className = "eb yellow";
		xhr.open("POST", "/api/comment?id=" + num);
		xhr.send(elts[5]);
	}
	function editNoBtn() {
		var num = this.data;
		var elts = ids[num];
		elts[1].value = elts[5];
		elts[0].className = "";
		elts[1].className = "hidden";
		elts[2].className = "eb";
		elts[3].className = "eb hidden";
		elts[4].className = "eb hidden";
	}
	function processResult(j) {
		if (!j.length) {
			msg.innerText = "No sessions available.";
			return;
		}
		msg.innerText = "Processingâ€¦";
		var i, r, c, elts = [], e;
		for (i = 0; i < j.length; ++i) {
			if (!Number.isInteger(j[i][0])) {
				console.error("no integer: " + j[i][0]);
				return;
			}
			elts[5] = xhsafe(j[i][2]);

			r = tbl.insertRow();
			c = r.insertCell();
			e = document.createElement('button');
			e.data = j[i][0];
			e.innerText = j[i][0];
			e.onclick = clkBtn;
			c.appendChild(e);
			c = r.insertCell();
			e = document.createElement('tt');
			e.innerText = xhsafe(j[i][1]);
			c.appendChild(e);
			c = r.insertCell();
			e = document.createElement('span');
			e.innerHTML = ta2s(elts[5]);
			elts[0] = e; // inner text span
			c.appendChild(e);
			e = document.createElement('textarea');
			e.className = "hidden";
			e.value = elts[5];
			elts[1] = e; // value textarea
			c.appendChild(e);
			c = r.insertCell();
			e = document.createElement('button')
			e.className = "eb";
			e.data = j[i][0];
			e.innerText = 'ðŸ–‰';
			e.onclick = pencilBtn;
			elts[2] = e; // edit button
			c.appendChild(e);
			e = document.createElement('button')
			e.className = "eb hidden";
			e.data = j[i][0];
			e.innerText = 'âœ”';
			e.onclick = editOkBtn;
			elts[3] = e; // ok button
			c.appendChild(e);
			e = document.createElement('button')
			e.className = "eb hidden";
			e.data = j[i][0];
			e.innerText = 'âœ˜';
			e.onclick = editNoBtn;
			elts[4] = e; // abort button
			c.appendChild(e);

			ids[j[i][0]] = elts;
			elts = [];
		}
		tbl.className = "";
		lst.removeChild(msg);
	}
	msg.innerText = "Loadingâ€¦";
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function xhrEvent() {
		if (xhr.readyState !== 4)
			return;
		if (xhr.status === 200)
			processResult(JSON.parse(xhr.responseText));
		else
			msg.innerText = "Error " + xhr.status +
			    " " + xhr.statusText;
	};
	xhr.open("GET", "/api/sessions", true);
	xhr.send();
  });
 //--><!]]></script>
</head><body>
<h1>jensjs sessions</h1>
<div id="sessionlist">
 <p id="msg">You need ECMAscript to see anything here, really.</p>
 <table id="tbl" border="0" class="hidden"><tr>
  <th style="width:1em;">ID</th>
  <th style="width:1em;">timestamp</th>
  <th>comment</th>
  <th style="width:1px;"></th>
 </tr></table>
</div>
<hr />
<address>jensjs by Deutsche Telekom LLCTO</address>
</body></html>
